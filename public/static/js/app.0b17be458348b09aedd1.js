webpackJsonp([1],{"7zck":function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("7+uW"),s=a("mtWM"),i=a.n(s),o=a("Rf8U"),r=a.n(o),l=a("/ocq"),c={BASE_URL:"https://lyceumexams.herokuapp.com/api/",LYCEUM_URL:"http://lyceum.by/admin/pupils/api/examStatus/",NONE_PLACE:{_id:"",code:"All",audience:[]},NONE_AUDIENCE:{_id:"",name:"All"},TABLE_HEADERS:[{text:"Абитуриент",align:"left",value:"firstName",width:"60%"},{text:"Аудитория",value:"audience",width:"30%"},{text:"Info",value:"examStatus",width:"10%"}],EXAM_STATUSES:{0:"ok",1:"неявка",2:"удален за дело",3:"удален по хорошей причине"},SNACKBAR_SUCCESS:"Статус сохранен",SNACKBAR_ERROR:"Не получилось"},d={search:function(t){return n.a.axios.get(c.BASE_URL+"pupils/search/saved",{params:{search:t}})},getPupils:function(t){return n.a.axios.get(c.BASE_URL+"pupils/saved",{params:t})},getDictionary:function(){return n.a.axios.get(c.BASE_URL+"dictionary")},getCorpses:function(){return n.a.axios.get(c.BASE_URL+"corpses/saved")},getCorps:function(t){return n.a.axios.get(c.BASE_URL+"corpses/saved/"+t)},sendPupilStatus:function(t,e){var a={examStatus:e};return n.a.axios.post(c.LYCEUM_URL+t._id,a).then(function(e){return n.a.axios.post(c.BASE_URL+"pupils/"+t._id,a)})}},u={data:function(){return{loading:!1}},created:function(){},methods:{fetch:function(){this.loading=!0,d.getCorpses().then(this.onSuccess).catch(this.onError).finally(this.loadingEnd)},onSuccess:function(t){this.items=t.data},onError:function(t){console.log(t)},loadingEnd:function(){this.loading=!1}}},p={render:function(){var t=this.$createElement,e=this._self._c||t;return e("v-container",{attrs:{fluid:"","fill-height":""}},[e("loading-indicator",{attrs:{loading:this.loading}}),this._v(" "),e("v-layout",{attrs:{"justify-center":"","align-center":""}},[e("v-flex",{attrs:{"text-xs-center":""}},[e("h1",{staticClass:"display-1"},[this._v("Выберите корпус")])])],1)],1)},staticRenderFns:[]};var h=a("VU/8")(u,p,!1,function(t){a("vEYS")},"data-v-2f32c15a",null).exports,g=a("woOf"),m=a.n(g),f={data:function(){return{search:"",loading:!1,snackbar:!1,snackbarText:c.SNACKBAR_SUCCESS,dialogData:{show:!1,editedIndex:-1,editedItem:{},selectedExamStatus:"0"},defaultItem:{},headers:c.TABLE_HEADERS,items:[]}},watch:{search:function(t){this.debounceSearch()}},methods:{debounceSearch:a("HhAh")(function(t){this.fetch()},500),toggleExpand:function(t){t.expanded=!t.expanded},onDialogClosed:function(t){this.items[t.editedIndex].examStatus=t.pupil.examStatus,""!==t.sneckbarText&&(this.fetch(),this.snackbarText=t.sneckbarText,this.snackbar=!0)},editItemDialog:function(t){t.examStatus=t.examStatus||"0",this.dialogData={editedIndex:this.items.indexOf(t),editedItem:m()({},t),show:!0}},fetch:function(){this.loading=!0,d.search(this.search||"").then(this.onSuccess).catch(this.onError).finally(this.loadingEnd)},onSuccess:function(t){this.items=t.data},onError:function(t){console.log(t)},loadingEnd:function(){this.loading=!1}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{"grid-list-xs":""}},[a("loading-indicator",{attrs:{loading:t.loading}}),t._v(" "),a("v-toolbar",{staticStyle:{top:"56px"},attrs:{fixed:""}},[a("v-container",{attrs:{fluid:"","grid-list-md":""}},[a("v-layout",{attrs:{row:"","align-center":""}},[a("v-flex",{attrs:{xs12:""}},[a("v-text-field",{attrs:{name:"nameSearch",label:"Поиск...","single-line":"",clearable:"","prepend-icon":"search"},on:{input:t.debounceSearch},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)],1)],1)],1),t._v(" "),a("v-layout",{staticStyle:{"margin-top":"56px"},attrs:{row:"","align-center":""}},[a("v-flex",{attrs:{xs12:""}},[a("v-data-table",{attrs:{headers:t.headers,items:t.items,"item-key":"_id","hide-actions":"",loading:t.loading,"no-data-text":"Ничего не найдено"},scopedSlots:t._u([{key:"items",fn:function(e){return[a("pupil-table-row",{attrs:{props:e,searchQuery:t.search},on:{toggleExpand:t.toggleExpand}})]}},{key:"expand",fn:function(e){return[a("pupil-table-expand",{attrs:{pupil:e.item},on:{toggleEdit:t.editItemDialog}})]}}])},[a("v-progress-linear",{attrs:{slot:"progress",color:"teal",indeterminate:""},slot:"progress"})],1),t._v(" "),a("change-status-dialog",{attrs:{dialogData:t.dialogData},on:{dialogClose:t.onDialogClosed}})],1)],1),t._v(" "),a("v-snackbar",{attrs:{timeout:4e3},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v("\n      "+t._s(t.snackbarText)+"\n      "),a("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(e){t.snackbar=!1}}},[t._v("Закрыть")])],1)],1)},staticRenderFns:[]},x=a("VU/8")(f,v,!1,null,null,null).exports,_=a("mvHQ"),S=a.n(_),b={data:function(){return{loading:!0,snackbar:!1,snackbarText:c.SNACKBAR_SUCCESS,dialogData:{show:!1,editedIndex:-1,editedItem:{},selectedExamStatus:"0"},defaultItem:{},corps:{},selectedPlace:{},selectedAudience:{},headers:c.TABLE_HEADERS,pupils:[]}},created:function(){this.fetchCorps()},watch:{$route:function(t,e){this.fetchCorps()},selectedPlace:function(t){this.placeChanged(t._id)}},methods:{onDialogClosed:function(t){this.pupils[t.editedIndex].examStatus=t.pupil.examStatus,""!==t.sneckbarText&&(this.fetchCorps(),this.snackbarText=t.sneckbarText,this.snackbar=!0)},editItemDialog:function(t){t.examStatus=t.examStatus||"0",this.dialogData={editedIndex:this.pupils.indexOf(t),editedItem:m()({},t),show:!0}},toggleExpand:function(t){t.expanded=!t.expanded},placeChanged:function(t){var e={corps:this.$route.params.corpsAlias,place:t};this.selectedAudience="",this.fetch(e)},fetch:function(t){this.loading=!0,d.getPupils(t).then(this.onPupilsSuccess).catch(this.onError).finally(this.loadingEnd)},fetchCorps:function(){var t=this.$route.params.corpsAlias;d.getCorps(t).then(this.onCorpsSuccess).catch(this.onError)},onPupilsSuccess:function(t){this.pupils=t.data},onCorpsSuccess:function(t){var e=this.$route.params.placeId||"",a=0,n=t.data.places.length,s=0,i=[];for(this.corps=m()({},t.data),n>1&&this.corps.places.unshift(JSON.parse(S()(c.NONE_PLACE))),n=this.corps.places.length;a<n;a++)this.corps.places[a]._id===e&&(s=a),i=i.concat(this.corps.places[a].audience),this.corps.places[a].audience.unshift(JSON.parse(S()(c.NONE_AUDIENCE)));n>1&&(this.corps.places[0].audience=this.corps.places[0].audience.concat(i.sort(E))),this.selectedPlace=this.corps.places[s]},getFIO:function(t){return t.firstName+" "+t.lastName+" "+t.parentName},loadingEnd:function(){this.loading=!1},onError:function(t){this.snackbarText=c.SNACKBAR_ERROR,this.snackbar=!0,console.log(t)}}};function E(t,e){return t.name>=e.name}var A={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{fluid:"","grid-list-xs":""}},[a("loading-indicator",{attrs:{loading:t.loading}}),t._v(" "),t.corps.name?a("v-toolbar",{staticStyle:{top:"56px"},attrs:{fixed:""}},[a("v-container",{attrs:{fluid:"","grid-list-md":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[t.corps.places?a("v-flex",{attrs:{xs6:""}},[a("v-select",{attrs:{items:t.corps.places,attach:!0,label:"Select","single-line":"","item-text":"code"},model:{value:t.selectedPlace,callback:function(e){t.selectedPlace=e},expression:"selectedPlace"}})],1):t._e(),t._v(" "),a("v-flex",{attrs:{xs6:""}},[a("v-select",{attrs:{items:t.selectedPlace.audience,label:"Select",attach:!0,"single-line":"","item-text":"`${data.item.name} + bel`","item-value":"_id"},scopedSlots:t._u([{key:"selection",fn:function(e){return[t._v("\n                  "+t._s(e.item.name)+t._s(!0===e.item.bel?" (бел)":"")+"\n                ")]}},{key:"item",fn:function(e){return[t._v("\n                  "+t._s(e.item.name)+t._s(!0===e.item.bel?" (бел)":"")+"\n                ")]}}]),model:{value:t.selectedAudience,callback:function(e){t.selectedAudience=e},expression:"selectedAudience"}})],1)],1)],1)],1):t._e(),t._v(" "),a("v-layout",{staticStyle:{"margin-top":"56px"},attrs:{column:"","align-center":""}},[a("v-flex",{attrs:{xs12:""}},[a("v-data-table",{attrs:{headers:t.headers,items:t.pupils,"item-key":"_id",search:t.selectedAudience,"hide-actions":"",loading:t.loading,"no-data-text":"Ничего не найдено"},scopedSlots:t._u([{key:"items",fn:function(e){return[a("pupil-table-row",{attrs:{props:e},on:{toggleExpand:t.toggleExpand}})]}},{key:"expand",fn:function(e){return[a("pupil-table-expand",{attrs:{pupil:e.item},on:{toggleEdit:t.editItemDialog}})]}}])},[a("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"})],1),t._v(" "),a("change-status-dialog",{attrs:{dialogData:t.dialogData},on:{dialogClose:t.onDialogClosed}})],1)],1),t._v(" "),a("v-snackbar",{attrs:{timeout:4e3},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v("\n      "+t._s(t.snackbarText)+"\n      "),a("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(e){t.snackbar=!1}}},[t._v("Закрыть")])],1)],1)},staticRenderFns:[]},k=a("VU/8")(b,A,!1,null,null,null).exports;n.a.use(r.a,i.a),n.a.use(l.a);var C=new l.a({routes:[{path:"/",name:"Home",component:h},{path:"/search",name:"Search",component:x},{path:"/table",name:"Table",component:k},{path:"/table/:corpsAlias",name:"TableCorps",component:k},{path:"/table/:corpsAlias/:placeId",name:"TableCorpsPlace",component:k}]}),T=a("3EgV"),I=a.n(T),R=[];d.getDictionary().then(function(t){R=t.data}).catch(function(t){console.log(t)});var D={getters:{DICTIONARY:function(){return R}}},N={render:function(){var t=this.$createElement,e=this._self._c||t;return this.loading?e("v-layout",{staticClass:"loading-container",attrs:{row:"","align-center":""}},[e("v-flex",{attrs:{xs12:"","text-xs-center":""}},[e("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1)],1):this._e()},staticRenderFns:[]};var w=a("VU/8")({name:"v-loading-indicator",props:["loading"]},N,!1,function(t){a("xUKd")},"data-v-4e3824cf",null).exports,y={name:"pupil-table-row",props:["props","searchQuery"],data:function(){return{DICTIONARY:D.getters.DICTIONARY()}},methods:{toggleExpand:function(){this.$emit("toggleExpand",this.props)},highlight:function(t){return t.replace(new RegExp(this.searchQuery,"gi"),"<b>$&</b>")},getFIO:function(){var t=this.props.item.firstName;return this.searchQuery&&(t=this.highlight(this.props.item.firstName)),t+" "+this.props.item.lastName+" "+this.props.item.parentName}}},O={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("tr",{on:{click:t.toggleExpand}},[a("td",[a("span",{domProps:{innerHTML:t._s(t.getFIO())}})]),t._v(" "),a("td",[t.DICTIONARY.audiences[t.props.item.audience]?a("span",[t._v("\n            "+t._s(t.DICTIONARY.audiences[t.props.item.audience])+" \n            "+t._s(!0===t.props.item.needBel?" (бел)":"")+"\n        ")]):t._e(),t._v(" "),a("br"),t._v(" "),t.DICTIONARY.places[t.props.item.place]?a("span",[a("nobr",{staticClass:"grey--text text--darken-2"},[t._v("\n            "+t._s(t.DICTIONARY.places[t.props.item.place].code)+"\n            ")])],1):t._e()]),t._v(" "),a("td",[t.props.item.examStatus>0?a("v-icon",{attrs:{color:"red"}},[t._v("info")]):t._e()],1)])},staticRenderFns:[]},U=a("VU/8")(y,O,!1,null,null,null).exports,$={name:"pupil-table-expand",props:["pupil"],data:function(){return{DICTIONARY:D.getters.DICTIONARY(),EXAM_STATUSES:c.EXAM_STATUSES}},methods:{toggleEdit:function(){this.$emit("toggleEdit",this.pupil)},getPhone:function(t){var e=t.replace(/\D/g,"").match(/(\d{3})(\d{2})(\d{3})(\d{2})(\d{2})/);return e[1]+"-("+e[2]+")-"+e[3]+"-"+e[4]+"-"+e[5]+" "}}},P={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",{attrs:{flat:""}},[a("v-container",{attrs:{"fill-height":"",fluid:""}},[a("v-layout",{attrs:{"fill-height":""}},[a("v-flex",{attrs:{xs12:"","align-end":"",flexbox:""}},[t._v("\n            Профиль: "+t._s(t.DICTIONARY.profiles[t.pupil.profile])+"\n        "),a("br"),t._v("\n        Телефон: "),a("a",{attrs:{href:"tel://"+t.getPhone(t.pupil.phone)}},[t._v("+"+t._s(t.getPhone(t.pupil.phone)))]),t._v(" "),a("br"),t._v("\n        email: "+t._s(t.pupil.email)+"\n        "),t.pupil.examStatus>0?a("span",{staticClass:"red--text"},[a("br"),t._v(" "),a("b",[t._v(t._s(t.EXAM_STATUSES[t.pupil.examStatus]))])]):t._e()]),t._v(" "),a("v-btn",{attrs:{icon:"",absolute:"",right:"",dark:"",color:"pink"},on:{click:t.toggleEdit}},[a("v-icon",{attrs:{dark:""}},[t._v("edit")])],1)],1)],1)],1)},staticRenderFns:[]},B=a("VU/8")($,P,!1,null,null,null).exports,Y={name:"change-status-dialog",props:["dialogData"],data:function(){return{loading:!1,editedIndex:this.dialogData.editedIndex,pupil:this.dialogData.editedItem,selectedExamStatus:this.dialogData.editedItem.examStatus,EXAM_STATUSES:c.EXAM_STATUSES}},watch:{dialogData:function(t){this.loading=!1,this.editedIndex=this.dialogData.editedIndex,this.pupil=this.dialogData.editedItem,this.selectedExamStatus=this.dialogData.editedItem.examStatus}},methods:{sendStatus:function(){this.loading=!0,d.sendPupilStatus(this.pupil,this.selectedExamStatus).then(this.onStatusSend).catch(this.onError).finally(this.loadingEnd)},loadingEnd:function(){this.loading=!1},onStatusSend:function(t){"ok"===t.data?(this.snackbarText=c.SNACKBAR_SUCCESS,this.pupil.examStatus=this.selectedExamStatus):this.snackbarText=c.SNACKBAR_ERROR,this.snackbar=!0,this.closeDialog(!0)},closeDialog:function(t){var e=!0===t?this.snackbarText:"";this.dialogData.show=!1,this.$emit("dialogClose",{pupil:this.pupil,editedIndex:this.editedIndex,sneckbarText:e})},onError:function(t){console.log(t),this.$emit("dialogClose",{pupil:this.pupil,editedIndex:this.editedIndex,sneckbarText:c.SNACKBAR_ERROR})}}},L={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-dialog",{attrs:{"max-width":"500px"},model:{value:t.dialogData.show,callback:function(e){t.$set(t.dialogData,"show",e)},expression:"dialogData.show"}},[a("loading-indicator",{attrs:{loading:t.loading}}),t._v(" "),a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[t._v(" Статус ")])]),t._v(" "),a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{wrap:""}},[a("v-flex",{attrs:{xs12:""}},[t._v("\n             "+t._s(t.pupil.firstName+" "+t.pupil.lastName+" "+t.pupil.parentName)+"\n           ")]),t._v(" "),a("v-radio-group",{attrs:{mandatory:!0},model:{value:t.selectedExamStatus,callback:function(e){t.selectedExamStatus=e},expression:"selectedExamStatus"}},t._l(t.EXAM_STATUSES,function(t,e){return a("v-radio",{key:e,attrs:{color:"red",label:""+t,value:e}})}))],1)],1)],1),t._v(" "),a("v-card-actions",[a("v-spacer"),t._v(" "),a("v-btn",{attrs:{color:"primary"},on:{click:t.sendStatus}},[t._v("Сохранить")]),t._v(" "),a("v-btn",{attrs:{color:"blue darken-1",flat:""},nativeOn:{click:function(e){return t.closeDialog(e)}}},[t._v("Отмена")])],1)],1)],1)},staticRenderFns:[]},H=a("VU/8")(Y,L,!1,null,null,null).exports,F=(a("7zck"),{data:function(){return{drawer:"Home"===this.$route.name,loading:!0,corpses:[],isSearch:"Search"===this.$route.name,isTable:"TableCorpsPlace"===this.$route.name,notHome:"Home"!==this.$route.name,title:"",DICTIONARY:{},offsetTop:0}},name:"App",created:function(){this.isTable?this.title=this.$route.params.corpsAlias:this.title="",d.getCorpses().then(this.onSuccess).catch(this.onError).finally(this.loadingEnd)},watch:{$route:function(t,e){this.isSearch="Search"===this.$route.name,this.notHome="Home"!==this.$route.name,this.isTable="TableCorpsPlace"===this.$route.name,this.isTable?this.title=this.$route.params.corpsAlias:this.title=""}},methods:{goBack:function(){"TableCorpsPlace"!==this.$route.name&&window.history.length>1?this.$router.go(-1):this.$router.push("/")},onScroll:function(t){this.offsetTop=window.pageYOffset||document.documentElement.scrollTop},scrollToTop:function(){return document.documentElement.scroll({top:0,behavior:"smooth"})},onSuccess:function(t){this.corpses=t.data,this.DICTIONARY=D.getters.DICTIONARY()},onError:function(t){console.log(t)},loadingEnd:function(){this.loading=!1}}}),M={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",[a("v-navigation-drawer",{attrs:{fixed:"",temporary:"",app:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[a("v-toolbar",{attrs:{flat:""}},[a("v-list",[a("v-list-tile",[a("v-list-tile-title",{staticClass:"title"},[t._v("\n            Список Корпусов\n          ")])],1)],1)],1),t._v(" "),a("v-divider"),t._v(" "),a("v-list",{staticClass:"grey lighten-4",attrs:{dense:""}},[t._l(t.corpses,function(e){return[a("v-list-tile",{key:e.alias,attrs:{href:"#/table/"+e.alias+"/all"}},[a("v-list-tile-content",[a("v-list-tile-title",[t._v("\n              "+t._s(e.name)+"\n            ")])],1)],1)]})],2)],1),t._v(" "),a("v-toolbar",{staticClass:"indigo lighten-1 white--text",attrs:{app:""}},[t.isSearch?a("v-btn",{staticClass:"mx-3 white--text",attrs:{icon:"",ripple:"",href:"#/"},on:{click:function(e){t.goBack()}}},[a("v-icon",[t._v("chevron_left")])],1):t._e(),t._v(" "),a("v-toolbar-side-icon",{staticClass:"white--text",on:{click:function(e){e.stopPropagation(),t.drawer=!t.drawer}}}),t._v(" "),a("v-toolbar-title",[t._v(t._s(t.DICTIONARY.corpses&&t.DICTIONARY.corpses[t.title]))]),t._v(" "),a("v-spacer"),t._v(" "),t.isTable?a("v-btn",{staticClass:"mx-3 white--text",attrs:{icon:"",ripple:"",href:"#/search"}},[a("v-icon",[t._v("search")])],1):t._e()],1),t._v(" "),a("v-content",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onScroll,expression:"onScroll"}]},[a("loading-indicator",{attrs:{loading:t.loading}}),t._v(" "),a("v-scale-transition",{attrs:{name:"fade"}},[a("router-view")],1),t._v(" "),a("v-fab-transition",[t.offsetTop>50?a("v-btn",{attrs:{color:"purple",dark:"",fab:"",fixed:"",bottom:"",right:""},on:{click:t.scrollToTop}},[a("v-icon",[t._v("keyboard_arrow_up")])],1):t._e()],1)],1),t._v(" "),a("v-footer",{staticClass:"pa-3",attrs:{app:""}},[a("div",[t._v("© "+t._s((new Date).getFullYear()))]),t._v(" "),a("v-spacer")],1)],1)},staticRenderFns:[]},K=a("VU/8")(F,M,!1,null,null,null).exports;n.a.use(r.a,i.a),n.a.use(I.a),n.a.use(d),n.a.use(D),n.a.component("loading-indicator",w),n.a.component("pupil-table-row",U),n.a.component("pupil-table-expand",B),n.a.component("change-status-dialog",H),n.a.config.productionTip=!1,new n.a({el:"#app",router:C,components:{App:K},template:"<App/>",CONSTANTS:c})},vEYS:function(t,e){},xUKd:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.0b17be458348b09aedd1.js.map